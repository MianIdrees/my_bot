<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" >

    <xacro:include filename="inertial_macros.xacro" />

    <!-- ==================== ROBOT PARAMETERS ==================== -->
    <!--
      Daniel's Robot — LattePanda Alpha + Arduino Leonardo
      Differential drive: 2 rear powered wheels + 1 front caster

      Physical dimensions (from measurements):
        Length:  0.437 m
        Width:   0.212 m
        Height:  0.089 m (ground to chassis top, excl. lidar/computer)
        Weight:  2.4 kg total

      Wheels:
        Diameter: 69 mm  (radius 0.0345 m)
        Width:    26 mm  (0.026 m)
        Outer-edge separation: 207 mm
        Center-to-center:      181 mm  (0.181 m)

      Drive axle: 147 mm from rear edge
      Caster:     190 mm forward of drive axle
      LiDAR:      106 mm from rear edge, centered laterally

      Coordinate convention:
        base_link at drive axle center, X-forward, Z-up
        base_footprint at ground plane (z = -wheel_radius)
    -->

    <!-- ==================== MATERIALS (RViz colors) ==================== -->
    <material name="white">
        <color rgba="1 1 1 1"/>
    </material>
    <material name="orange">
        <color rgba="1 0.3 0 1"/>
    </material>
    <material name="blue">
        <color rgba="0.1 0.1 0.8 1"/>
    </material>
    <material name="black">
        <color rgba="0.05 0.05 0.05 1"/>
    </material>
    <material name="dark_grey">
        <color rgba="0.2 0.2 0.2 1"/>
    </material>
    <material name="silver">
        <color rgba="0.75 0.75 0.75 1"/>
    </material>
    <material name="red">
        <color rgba="1 0 0 1"/>
    </material>
    <material name="wood">
        <color rgba="0.76 0.60 0.42 1"/>
    </material>

    <!-- ==================== BASE LINK ==================== -->
    <link name="base_link"> </link>

    <!-- ==================== BASE FOOTPRINT (ground plane) ==================== -->
    <joint name="base_footprint_joint" type="fixed">
        <parent link="base_link"/>
        <child link="base_footprint"/>
        <origin xyz="0 0 -0.0345" rpy="0 0 0"/>
    </joint>
    <link name="base_footprint"> </link>

    <!-- ==================== CHASSIS ==================== -->
    <!--
      Chassis = wooden platform (0.437 x 0.212 x 0.020 m)
      Mounted on vertical supports above the wheels.
      Bottom of chassis at z=0.035 (just above wheel tops at 0.0345)
      Top of chassis at z=0.055 above base_link
      Total height from ground: 0.0345 + 0.055 = 0.0895 m ≈ 89 mm ✓
    -->
    <joint name="chassis_joint" type="fixed">
        <parent link="base_link"/>
        <child link="chassis"/>
        <origin xyz="-0.147 0 0" rpy="0 0 0"/>
    </joint>

    <link name="chassis">
        <visual>
            <origin xyz="0.2185 0 0.045" rpy="0 0 0"/>
            <geometry>
                <box size="0.437 0.212 0.020"/>
            </geometry>
            <material name="wood"/>
        </visual>
        <collision>
            <origin xyz="0.2185 0 0.045" rpy="0 0 0"/>
            <geometry>
                <box size="0.437 0.212 0.020"/>
            </geometry>
        </collision>
        <xacro:inertial_box mass="2.0" x="0.437" y="0.212" z="0.020">
            <origin xyz="0.2185 0 0.045" rpy="0 0 0"/>
        </xacro:inertial_box>
    </link>

    <!-- ==================== WHEEL SUPPORT POSTS ==================== -->
    <!-- Vertical wood support connecting chassis to motor/axle mount area -->
    <!-- Left support post -->
    <joint name="left_support_joint" type="fixed">
        <parent link="chassis"/>
        <child link="left_support"/>
        <origin xyz="0.147 0.07 0" rpy="0 0 0"/>
    </joint>
    <link name="left_support">
        <visual>
            <origin xyz="0 0 0.0175" rpy="0 0 0"/>
            <geometry>
                <box size="0.04 0.02 0.035"/>
            </geometry>
            <material name="wood"/>
        </visual>
    </link>

    <!-- Right support post -->
    <joint name="right_support_joint" type="fixed">
        <parent link="chassis"/>
        <child link="right_support"/>
        <origin xyz="0.147 -0.07 0" rpy="0 0 0"/>
    </joint>
    <link name="right_support">
        <visual>
            <origin xyz="0 0 0.0175" rpy="0 0 0"/>
            <geometry>
                <box size="0.04 0.02 0.035"/>
            </geometry>
            <material name="wood"/>
        </visual>
    </link>

    <!-- ==================== MOTOR HOUSINGS ==================== -->
    <!--
      DC motor cylinders between support posts and wheels.
      Oriented along Y axis (perpendicular to chassis).
      Radius ~14mm, length ~40mm — bridges from support post to wheel.
      Centered at wheel X position, between post and wheel in Y.
    -->
    <!-- Left motor -->
    <joint name="left_motor_joint" type="fixed">
        <parent link="chassis"/>
        <child link="left_motor"/>
        <origin xyz="0.147 0.065 0" rpy="0 0 0"/>
    </joint>
    <link name="left_motor">
        <visual>
            <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
            <geometry>
                <cylinder radius="0.014" length="0.040"/>
            </geometry>
            <material name="dark_grey"/>
        </visual>
    </link>

    <!-- Right motor -->
    <joint name="right_motor_joint" type="fixed">
        <parent link="chassis"/>
        <child link="right_motor"/>
        <origin xyz="0.147 -0.065 0" rpy="0 0 0"/>
    </joint>
    <link name="right_motor">
        <visual>
            <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
            <geometry>
                <cylinder radius="0.014" length="0.040"/>
            </geometry>
            <material name="dark_grey"/>
        </visual>
    </link>

    <!-- ==================== LEFT WHEEL ==================== -->
    <!--
      Center-to-center wheel separation: 0.181 m
      Each wheel at y = ±0.0905 m from base_link
      Wheel: radius 0.0345m, width 0.026m
    -->
    <joint name="left_wheel_joint" type="continuous">
        <parent link="base_link"/>
        <child link="left_wheel"/>
        <origin xyz="0 0.0905 0" rpy="-${pi/2} 0 0"/>
        <axis xyz="0 0 1"/>
    </joint>
    <link name="left_wheel">
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <cylinder radius="0.0345" length="0.026"/>
            </geometry>
            <material name="dark_grey"/>
        </visual>
        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <sphere radius="0.0345"/>
            </geometry>
        </collision>
        <xacro:inertial_cylinder mass="0.1" length="0.026" radius="0.0345">
            <origin xyz="0 0 0" rpy="0 0 0"/>
        </xacro:inertial_cylinder>
    </link>

    <!-- ==================== RIGHT WHEEL ==================== -->
    <joint name="right_wheel_joint" type="continuous">
        <parent link="base_link"/>
        <child link="right_wheel"/>
        <origin xyz="0 -0.0905 0" rpy="${pi/2} 0 0"/>
        <axis xyz="0 0 -1"/>
    </joint>
    <link name="right_wheel">
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <cylinder radius="0.0345" length="0.026"/>
            </geometry>
            <material name="dark_grey"/>
        </visual>
        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <sphere radius="0.0345"/>
            </geometry>
        </collision>
        <xacro:inertial_cylinder mass="0.1" length="0.026" radius="0.0345">
            <origin xyz="0 0 0" rpy="0 0 0"/>
        </xacro:inertial_cylinder>
    </link>

    <!-- ==================== CASTER MOUNT BRACKET ==================== -->
    <!--
      Vertical bracket connecting chassis bottom (z=0.035) to caster area.
      Fills the visual gap between the chassis plate and the caster ball.
      Height: 40mm, from z=-0.005 to z=0.035 (chassis bottom).
    -->
    <joint name="caster_mount_joint" type="fixed">
        <parent link="chassis"/>
        <child link="caster_mount"/>
        <origin xyz="0.337 0 0.015" rpy="0 0 0"/>
    </joint>
    <link name="caster_mount">
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <box size="0.020 0.015 0.040"/>
            </geometry>
            <material name="silver"/>
        </visual>
    </link>

    <!-- ==================== CASTER WHEEL ==================== -->
    <!--
      Passive front caster, 190 mm forward of drive axle.
      Relative to chassis link: x = 0.190 + 0.147 = 0.337 m
      Small sphere (radius 0.015m) at z = -0.0195 so it contacts ground
    -->
    <joint name="caster_wheel_joint" type="fixed">
        <parent link="chassis"/>
        <child link="caster_wheel"/>
        <origin xyz="0.337 0 -0.0195"/>
    </joint>
    <link name="caster_wheel">
        <visual>
            <geometry>
                <sphere radius="0.015"/>
            </geometry>
            <material name="silver"/>
        </visual>
        <collision>
            <geometry>
                <sphere radius="0.015"/>
            </geometry>
        </collision>
        <xacro:inertial_sphere mass="0.05" radius="0.015">
            <origin xyz="0 0 0" rpy="0 0 0"/>
        </xacro:inertial_sphere>
    </link>

    <!-- ==================== LIDAR RISER POST ==================== -->
    <!--
      Wooden post supporting the LiDAR above the chassis.
      Fills the gap between chassis top (z=0.055) and LiDAR bottom (z=0.08).
      Height: 25mm, centered at z=0.0675, at LiDAR x position.
    -->
    <joint name="lidar_riser_joint" type="fixed">
        <parent link="chassis"/>
        <child link="lidar_riser"/>
        <origin xyz="0.106 0 0.0675" rpy="0 0 0"/>
    </joint>
    <link name="lidar_riser">
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <box size="0.040 0.040 0.025"/>
            </geometry>
            <material name="wood"/>
        </visual>
    </link>

</robot>